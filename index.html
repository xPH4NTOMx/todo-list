<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>To-Do List Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex justify-center p-6 transition-colors duration-500">
<div class="bg-white dark:bg-gray-800 shadow-2xl rounded-2xl w-full max-w-md p-6 transition-colors duration-500">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-blue-600 dark:text-blue-400">ğŸ“ To-Do List Pro</h1>
    <button onclick="toggleDarkMode()" class="px-3 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200">ğŸŒ™</button>
  </div>

  <div class="space-y-2 mb-4">
    <input id="taskInput" type="text" placeholder="à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³..." class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none">
    <select id="categoryInput" class="w-full border rounded-lg px-3 py-2 text-gray-800 dark:text-gray-200">
      <option value="à¸‡à¸²à¸™à¸šà¹‰à¸²à¸™">ğŸ  à¸‡à¸²à¸™à¸šà¹‰à¸²à¸™</option>
      <option value="à¸‡à¸²à¸™à¹€à¸£à¸µà¸¢à¸™">ğŸ“š à¸‡à¸²à¸™à¹€à¸£à¸µà¸¢à¸™</option>
      <option value="à¸‡à¸²à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§">ğŸ™‹ à¸‡à¸²à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</option>
    </select>
    <input id="deadlineInput" type="datetime-local" class="w-full border rounded-lg px-3 py-2">
    <button onclick="addTask()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">â• à¹€à¸à¸´à¹ˆà¸¡</button>
  </div>

  <div class="flex mb-4 gap-2">
    <input id="searchInput" type="text" placeholder="à¸„à¹‰à¸™à¸«à¸²..." class="flex-1 border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" oninput="renderTasks()">
    <select id="filterSelect" onchange="renderTasks()" class="border rounded-lg px-2 py-2 text-gray-800 dark:text-gray-200">
      <option value="all">à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</option>
      <option value="completed">à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§</option>
      <option value="pending">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸ªà¸£à¹‡à¸ˆ</option>
    </select>
  </div>

  <div id="stats" class="mb-4 text-sm text-gray-600 dark:text-gray-300"></div>
  <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded mb-4">
    <div id="progressBar" class="h-2 bg-green-500 rounded" style="width:0%"></div>
  </div>

  <ul id="taskList" class="space-y-2"></ul>

  <div class="flex justify-between mt-6">
    <button onclick="exportTasks()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg">â¬‡ Export JSON</button>
    <label class="cursor-pointer bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg">
      â¬† Import JSON
      <input type="file" id="importFile" accept=".json" class="hidden" onchange="importTasks(event)">
    </label>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

// Dark Mode
function toggleDarkMode() {
  document.documentElement.classList.toggle("dark");
  localStorage.setItem("darkMode", document.documentElement.classList.contains("dark"));
}
if (localStorage.getItem("darkMode") === "true") document.documentElement.classList.add("dark");

// Render Tasks
function renderTasks() {
  const list = document.getElementById("taskList");
  const search = document.getElementById("searchInput").value.toLowerCase();
  const filter = document.getElementById("filterSelect").value;
  list.innerHTML = "";

  const filtered = tasks.filter(t => t.text.toLowerCase().includes(search))
                        .filter(t => filter === "completed" ? t.completed : filter === "pending" ? !t.completed : true);

  filtered.forEach(task => {
    const index = tasks.indexOf(task);
    let deadlineColor = "bg-gray-50 dark:bg-gray-700";
    if (task.deadline) {
      const now = new Date();
      const due = new Date(task.deadline);
      if (due < now) deadlineColor = "bg-red-100 dark:bg-red-800";
      else if (due - now < 24*60*60*1000) deadlineColor = "bg-yellow-100 dark:bg-yellow-800";
      else deadlineColor = "bg-green-100 dark:bg-green-800";
    }

    const li = document.createElement("li");
    li.className = `flex items-center justify-between p-3 rounded-lg shadow-sm animate__animated animate__fadeIn ${deadlineColor}`;
    li.innerHTML = `
      <div class="flex flex-col">
        <div class="flex items-center gap-2">
          <input type="checkbox" ${task.completed ? "checked" : ""} onclick="toggleComplete(${index})" class="w-4 h-4">
          <span class="text-sm ${task.completed ? "line-through text-gray-500" : "dark:text-gray-200"}">${task.text}</span>
        </div>
        <span class="text-xs text-gray-500 dark:text-gray-400">ğŸ“‚ ${task.category || "à¸—à¸±à¹ˆà¸§à¹„à¸›"}</span>
        ${task.deadline ? `<span class="text-xs text-gray-400 dark:text-gray-300">â° ${new Date(task.deadline).toLocaleString()}</span>` : ""}
      </div>
      <div class="flex gap-2">
        <button onclick="editTask(${index})" class="bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 rounded text-xs">âœ</button>
        <button onclick="removeTask(${index})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">ğŸ—‘</button>
      </div>
    `;
    list.appendChild(li);
  });

  updateStats();
}

// Update stats
function updateStats() {
  const stats = document.getElementById("stats");
  const total = tasks.length;
  const completed = tasks.filter(t => t.completed).length;
  stats.innerText = `à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${total} | à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§: ${completed} | à¸„à¹‰à¸²à¸‡: ${total - completed}`;
  document.getElementById("progressBar").style.width = total > 0 ? (completed/total*100) + "%" : "0%";
}

// CRUD
function addTask() {
  const input = document.getElementById("taskInput");
  const category = document.getElementById("categoryInput").value;
  const deadline = document.getElementById("deadlineInput").value;
  const text = input.value.trim();
  if (text === "") return;
  tasks.push({text, completed:false, category, deadline});
  localStorage.setItem("tasks", JSON.stringify(tasks));
  input.value = "";
  document.getElementById("deadlineInput").value = "";
  renderTasks();
}

function toggleComplete(index){ tasks[index].completed = !tasks[index].completed; localStorage.setItem("tasks", JSON.stringify(tasks)); renderTasks(); }
function editTask(index){ const t=prompt("à¹à¸à¹‰à¹„à¸‚à¸‡à¸²à¸™:", tasks[index].text); if(t!==null && t.trim()!==""){ tasks[index].text=t.trim(); localStorage.setItem("tasks", JSON.stringify(tasks)); renderTasks(); } }
function removeTask(index){ if(confirm("à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸‡à¸²à¸™à¸™à¸µà¹‰à¸ˆà¸£à¸´à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")){ tasks.splice(index,1); localStorage.setItem("tasks", JSON.stringify(tasks)); renderTasks(); } }

function exportTasks(){ const blob = new Blob([JSON.stringify(tasks,null,2)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="tasks.json"; a.click(); }
function importTasks(e){ const file=e.target.files[0]; if(!file)return; const reader=new FileReader(); reader.onload=function(ev){ try{ const data=JSON.parse(ev.target.result); if(Array.isArray(data)){ tasks=data; localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); } else alert("à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"); }catch{ alert("à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ"); } }; reader.readAsText(file); }

// Sortable
new Sortable(document.getElementById("taskList"), {animation:150,onEnd:(evt)=>{ const [moved]=tasks.splice(evt.oldIndex,1); tasks.splice(evt.newIndex,0,moved); localStorage.setItem("tasks",JSON.stringify(tasks)); renderTasks(); }});

renderTasks();
</script>
</body>
</html>
